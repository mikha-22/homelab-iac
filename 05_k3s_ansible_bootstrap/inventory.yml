# ===================================================================
#  K3S ANSIBLE INVENTORY - DYNAMICALLY GENERATED BY TERRAFORM
#  This file is auto-generated from Terraform. Do not edit manually.
#  Source: 04_bootstrap_vm_nodes/03_deploy_vm/main.tf
# ===================================================================

---
k3s_cluster:
  children:
    server:
      hosts:
        # Master node - IP from Terraform shared config
        192.168.1.181:
          ansible_user: ubuntu
          # Set the K3s node name to match the hostname
          k3s_node_name: dev-k3s-master-01
          # VM info for reference
          vm_id: 181
          proxmox_node: pve1
          
    agent:
      hosts:
        # Worker node - IP from Terraform shared config
        192.168.1.182:
          ansible_user: ubuntu
          # Set the K3s node name to match the hostname
          k3s_node_name: dev-k3s-worker-01
          # VM info for reference
          vm_id: 182
          proxmox_node: pve2

  vars:
    # K3s configuration
    k3s_version: "v1.29.5+k3s1"
    
    # API endpoint - uses master IP from Terraform
    api_endpoint: "192.168.1.181"
    
    # Cluster token - securely managed in Google Secret Manager
    k3s_token: "k3s-homelab-a6b65198173f90d09a83372f266d64ce"
    
    # Network configuration (matches Terraform shared config)
    cluster_cidr: "10.42.0.0/16"      # K3s default pod network
    service_cidr: "10.43.0.0/16"      # K3s default service network
    cluster_dns: "10.43.0.10"         # K3s default CoreDNS
    
    # Disable components we don't need in homelab
    k3s_server_config:
      kube-controller-manager-arg:
        - "bind-address=0.0.0.0"
      kube-proxy-arg:
        - "metrics-bind-address=0.0.0.0"
      kube-scheduler-arg:
        - "bind-address=0.0.0.0"
      etcd-expose-metrics: true
    
    k3s_agent_config:
      kube-proxy-arg:
        - "metrics-bind-address=0.0.0.0"

# ===================================================================
#  AUTO-GENERATED CONFIGURATION NOTES
# ===================================================================

# Network Layout (from Terraform shared config):
# - Host network: 192.168.1.0/24
# - NAS server: 192.168.1.225
# - K3s master: 192.168.1.181
# - K3s worker: 192.168.1.182
# - Gateway: 192.168.1.1
# - DNS: 1.1.1.1, 8.8.8.8
# - Domain: milenika.dev

# K3s Internal Networks:
# - Pod CIDR: 10.42.0.0/16 (default)
# - Service CIDR: 10.43.0.0/16 (default)  
# - CoreDNS: 10.43.0.10 (default)

# After K3s Installation:
# 1. Kubeconfig will be at: /etc/rancher/k3s/k3s.yaml (on master)
# 2. Copy to your local machine: ~/.kube/config
# 3. Update server URL to: https://192.168.1.181:6443
# 4. Test with: kubectl get nodes

# Troubleshooting:
# - SSH to master: ssh ubuntu@192.168.1.181
# - SSH to worker: ssh ubuntu@192.168.1.182
# - Check K3s logs: sudo journalctl -u k3s -f
# - Restart K3s: sudo systemctl restart k3s

# SECURITY NOTE: This file contains the K3s cluster token.
# The token is managed securely in Google Secret Manager.
# Do not commit this generated file to version control.
